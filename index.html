<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Location Sharing</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
</head>
<body>
    <div>
        <label for="location">Location:</label>
        <input type="text" id="location" placeholder="Enter a location" />
        <button onclick="geocodeLocation()">Find Location</button>
    </div>
    <div>
        <button onclick="getUserLocation()">Get My Location</button>
    </div>
    <div id="map" style="height: 400px;"></div>
    <button onclick="sendLocationToWhatsApp()">Send Location to WhatsApp</button>

    <script>
        var map = L.map("map").setView([48.8566, 2.3522], 15); // Initial coordinates
        var marker = L.marker([0, 0]).addTo(map);
        var newLatitude = 0;
        var newLongitude = 0;

        // Add OpenStreetMap tile layer
        L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);

        function geocodeLocation() {
            var locationInput = document.getElementById("location").value;

            // Use OpenStreetMap's Nominatim geocoding service
            var geocodeURL = "https://nominatim.openstreetmap.org/search?format=json&q=" + locationInput;

            fetch(geocodeURL)
                .then(response => response.json())
                .then(data => {
                    if (data.length > 0) {
                        // Extract coordinates from the geocoding response
                        newLatitude = parseFloat(data[0].lat);
                        newLongitude = parseFloat(data[0].lon);

                        map.setView([newLatitude, newLongitude], 15);
                        marker.setLatLng([newLatitude, newLongitude]);
                        marker.bindPopup("Updated Marker Title").openPopup();
                    } else {
                        alert("Location not found.");
                    }
                })
                .catch(error => {
                    console.error(error);
                    alert("Error geocoding location.");
                });
        }

        function getUserLocation() {
            if ("geolocation" in navigator) {
                navigator.geolocation.getCurrentPosition(function (position) {
                    newLatitude = position.coords.latitude;
                    newLongitude = position.coords.longitude;

                    map.setView([newLatitude, newLongitude], 15);
                    marker.setLatLng([newLatitude, newLongitude]);
                    marker.bindPopup("My Location").openPopup();
                }, function (error) {
                    console.error("Error getting location: " + error.message);
                    alert("Error getting your location. Please enable location services.");
                });
            } else {
                alert("Geolocation is not supported by your browser.");
            }
        }

        function sendLocationToWhatsApp() {
            var locationURL = "https://www.openstreetmap.org/?mlat=" + newLatitude + "&mlon=" + newLongitude;
            var whatsappMessage = "Check out my location: " + locationURL;

            var phoneNumber = "233591936564"; // Replace with the desired WhatsApp number

            var whatsappURL = "https://api.whatsapp.com/send?phone=" + phoneNumber + "&text=" + encodeURIComponent(whatsappMessage);

            window.open(whatsappURL);
        }
    </script>
</body>
</html>
